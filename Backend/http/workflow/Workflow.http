@baseUrl = http://localhost:9090/api
@token = 

### Step 1: Sign in to get token
# @name signin
POST {{baseUrl}}/auth/signin
Content-Type: application/json

{
  "username": "hyperar69@gmail.com",
  "password": "1234"
}

> {%
    client.global.set("token", response.body.accessToken);
%}

###

### Step 2: Create a new workflow
POST {{baseUrl}}/workflows
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Sample Image Processing Workflow",
  "description": "A workflow for processing satellite images",
  "projectId": "project123",
  "timeoutSeconds": 3600,
  "tags": ["image-processing", "satellite"],
  "nodes": [
    {
      "id": "node1",
      "type": "TRIGGER",
      "name": "Start",
      "description": "Workflow trigger",
      "position": {
        "x": 100,
        "y": 100
      },
      "taskReferenceName": "trigger_start",
      "configuration": {
        "taskType": "SIMPLE",
        "taskName": "workflow_trigger"
      }
    },
    {
      "id": "node2",
      "type": "TASK",
      "name": "Load Image",
      "description": "Load satellite image from storage",
      "position": {
        "x": 300,
        "y": 100
      },
      "taskReferenceName": "load_image_task",
      "configuration": {
        "taskType": "SIMPLE",
        "taskName": "load_image",
        "timeoutSeconds": 300,
        "retryConfig": {
          "retryCount": 3,
          "retryDelaySeconds": 10,
          "retryLogic": "FIXED"
        }
      },
      "inputParameters": {
        "imageId": "${workflow.input.imageId}"
      }
    }
  ],
  "edges": [
    {
      "id": "edge1",
      "sourceNodeId": "node1",
      "targetNodeId": "node2",
      "label": "next"
    }
  ]
}

###

### Get all workflows
GET {{baseUrl}}/workflows
Authorization: Bearer {{token}}

###

### Get workflow by ID (replace WORKFLOW_ID with actual ID from create response)
@workflowId = WORKFLOW_ID_HERE
GET {{baseUrl}}/workflows/{{workflowId}}
Authorization: Bearer {{token}}

###

### Get workflows by project
GET {{baseUrl}}/workflows/project/project123
Authorization: Bearer {{token}}

###

### Get workflows by status
GET {{baseUrl}}/workflows/status/DRAFT
Authorization: Bearer {{token}}

###

### Update workflow (replace WORKFLOW_ID)
PUT {{baseUrl}}/workflows/{{workflowId}}
Content-Type: application/json
Authorization: Bearer {{token}}

{
  "name": "Updated Workflow Name",
  "description": "Updated description",
  "status": "DRAFT"
}

###

### Publish workflow (replace WORKFLOW_ID)
POST {{baseUrl}}/workflows/{{workflowId}}/publish
Authorization: Bearer {{token}}

###

### Delete workflow (replace WORKFLOW_ID)
DELETE {{baseUrl}}/workflows/{{workflowId}}
Authorization: Bearer {{token}}

###

### Step 3: Register workflow with Conductor
POST {{baseUrl}}/workflows/{{workflowId}}/register
Authorization: Bearer {{token}}

###

### Step 4: Get Conductor workflow definition
GET {{baseUrl}}/workflows/{{workflowId}}/conductor-def
Authorization: Bearer {{token}}
